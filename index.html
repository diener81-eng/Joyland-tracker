<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Joyland Tracker</title>

<style>
  body {
    font-family: system-ui, sans-serif;
    background: #0f0f0f;
    color: #fff;
    text-align: center;
    padding: 1rem;
  }

  button {
    font-size: 1.05rem;
    padding: 1rem;
    margin: .35rem;
    width: 90%;
    max-width: 420px;
    border-radius: 12px;
    border: none;
  }

  .start { background:#2ecc71; color:#000; font-weight:bold; }
  .tiny { background:#444; }
  .axe { background:#c0392b; }
  .treasure { background:#2980b9; }
  .block { background:#27ae60; }
  .jackpot { background:#f1c40f; color:#000; }
  .crossroads { background:#16a085; }
  .undo { background:#8e44ad; }
  .reset { background:#555; }

  .divider {
    margin:1rem auto;
    width:90%;
    max-width:420px;
    border-top:1px solid #333;
  }

  .timeline {
    display:flex;
    justify-content:center;
    margin-top:.5rem;
  }

  .cell {
    width:26px;
    height:26px;
    margin:3px;
    border-radius:6px;
    background:#333;
    font-size:.8rem;
    line-height:26px;
  }

  .done { background:#666; }
  .current { background:#3498db; }
  .warning { background:#e67e22; }

  .alert {
    margin-top:.5rem;
    font-size:1.1rem;
    font-weight:bold;
    color:#ff9f43;
  }

  #timelineBottom { margin-top:8px; }
</style>
</head>

<body>

<h2>Joyland Tracker</h2>

<button class="start" onclick="startNewSequence()">
  This is the start of a new sequence
</button>

<button class="tiny" onclick="log('Tiny Adventures')">T · Tiny</button>
<button class="crossroads" onclick="log('Crossroads of Fate')">F · Crossroads</button>
<button class="axe" onclick="log('Axe Ricochet')">A · Axe</button>
<button class="treasure" onclick="log('Treasure Hunt')">C · Treasure Hunt</button>
<button class="block" onclick="log('Blocks Duel')">B · Blocks</button>
<button class="jackpot" onclick="log('Jackpot')">J · Jackpot</button>

<pre id="status"></pre>
<div class="alert" id="alert"></div>

<div class="timeline" id="timelineTop"></div>
<div class="timeline" id="timelineBottom"></div>

<div class="divider"></div>
<button class="undo" onclick="undo()">Undo</button>
<button class="reset" onclick="resetAll()">Reset All</button>

<script>
const sequences={
  1:["Tiny Adventures","Crossroads of Fate","Tiny Adventures","Blocks Duel","Tiny Adventures","Tiny Adventures","Crossroads of Fate","Treasure Hunt","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Blocks Duel","Jackpot"],
  2:["Tiny Adventures","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Treasure Hunt","Tiny Adventures","Tiny Adventures","Crossroads of Fate","Jackpot","Crossroads of Fate","Tiny Adventures","Blocks Duel"],
  3:["Tiny Adventures","Tiny Adventures","Crossroads of Fate","Treasure Hunt","Tiny Adventures","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Jackpot","Tiny Adventures","Blocks Duel","Crossroads of Fate"],
  4:["Tiny Adventures","Tiny Adventures","Treasure Hunt","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Crossroads of Fate","Axe Ricochet","Jackpot"]
};

const abbrev={
  "Tiny Adventures":"T",
  "Crossroads of Fate":"F",
  "Axe Ricochet":"A",
  "Treasure Hunt":"C",
  "Blocks Duel":"B",
  "Jackpot":"J"
};

let history=[];
let possibilities=[];
let forcedStart=false;

function startNewSequence(){
  history=[];
  possibilities=[];
  forcedStart=true;
  render();
}

function resetAll(){
  history=[];
  possibilities=[];
  forcedStart=false;
  render();
}

function undo(){
  history.pop();
  rebuild();
}

function rebuild(){
  possibilities=[];
  history.forEach(e=>process(e));
  render();
}

function log(event){
  history.push(event);
  process(event);
  render();
}

function process(event){
  if(!possibilities.length){
    for(const [seq,moves] of Object.entries(sequences)){
      if(forcedStart){
        if(moves[0]===event)
          possibilities.push({seq,move:1});
      } else {
        moves.forEach((m,i)=>{
          if(m===event)
            possibilities.push({seq,move:i+1});
        });
      }
    }
  } else {
    possibilities = possibilities
      .filter(p=>sequences[p.seq][p.move]===event)
      .map(p=>({seq:p.seq,move:p.move+1}));
  }
}

function render(){
  const status=document.getElementById("status");
  const alert=document.getElementById("alert");
  const top=document.getElementById("timelineTop");
  const bottom=document.getElementById("timelineBottom");

  top.innerHTML="";
  bottom.innerHTML="";
  alert.textContent="";

  if(!history.length){
    status.textContent=forcedStart
      ? "Start-of-sequence mode enabled.\nWaiting for input..."
      : "Waiting for input...";
    return;
  }

  status.textContent=
    `Moves: ${history.length}\nPossible: ${possibilities.length}`;

  if(possibilities.length===1){
    const p=possibilities[0];
    const moves=sequences[p.seq];
    status.textContent=
      `Sequence ${p.seq}\nMove ${p.move} / 13`;

    moves.forEach((m,i)=>{
      const cell=document.createElement("div");
      cell.className="cell";
      if(i+1<p.move) cell.classList.add("done");
      if(i+1===p.move) cell.classList.add("current");

      let l=abbrev[m];
      if(l==="A"||l==="C") l=`<b>${l}</b>`;
      cell.innerHTML=`<small>${i+1}</small><br>${l}`;

      if(m==="Axe Ricochet"||m==="Treasure Hunt")
        cell.style.border="2px solid white";

      (i<6?top:bottom).appendChild(cell);
    });

    forcedStart=false;
  }
}
</script>

</body>
</html>
