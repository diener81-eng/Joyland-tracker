<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Joyland Tracker</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background:#0f0f0f;
  color:#fff;
  text-align:center;
  padding:1rem;
}

.instructions {
  background:#1a1a1a;
  border:2px solid #2ecc71;
  border-radius:12px;
  padding:1rem;
  margin:1rem auto;
  max-width:420px;
  font-size:0.95rem;
  line-height:1.6;
}

.button-grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 0.5rem;
  max-width: 420px;
  margin: 0 auto;
  padding: 0.5rem 0;
}

button {
  font-size:0.9rem;
  padding:0.7rem 1rem;
  border-radius:8px;
  border:none;
  flex: 0 1 auto;
  min-width: 120px;
}

.start { 
  background:#2ecc71; 
  color:#000; 
  font-weight:bold;
  width: 100%;
  max-width: 420px;
  margin: 0.5rem auto;
  display: block;
}

.tiny { background:#444; }
.crossroads { background:#16a085; }
.axe { background:#c0392b; }
.card { background:#2980b9; }
.block { background:#27ae60; }
.jackpot { background:#f1c40f; color:#000; }

.undo { background:#8e44ad; }
.reset { background:#555; }

.history {
  max-height:100px;
  overflow-y:auto;
  background:#181818;
  border-radius:10px;
  padding:.5rem;
  font-size:.85rem;
  color:#ccc;
  margin:.75rem auto;
  width:90%;
  max-width:420px;
  text-align:left;
}

.timeline { display:flex; justify-content:center; margin-top:.5rem; }
#timelineBottom { margin-top:10px; margin-bottom:1rem; }

.cell {
  width:28px;
  height:28px;
  margin:4px;
  border-radius:6px;
  font-size:.8rem;
  line-height:28px;
  background:#333;
}

.done { filter:brightness(.6); }
.current { outline:3px solid #fff; }
.warning { outline:3px solid #e67e22; }

.alert { margin-top:.5rem; font-size:1.05rem; font-weight:bold; }

.controls {
  position: sticky;
  bottom: 0;
  background: #0f0f0f;
  padding: 1rem 0;
  margin-top: 1rem;
  display: flex;
  justify-content: center;
  gap: 0.5rem;
}

.controls button {
  min-width: 100px;
}
</style>
</head>

<body>

<h2>Joyland Tracker</h2>

<div class="instructions">
  Tap each event as it appears in Joyland.<br>
  You will be warned when to use <b>50Ã— compass</b>.<br>
  Axe Ricochet â†’ always 50Ã—<br>
  Card Realm â†’ 50Ã— only if you need gold
</div>

<button class="start" onclick="manualStart()">
This is the start of a new sequence
</button>

<div class="button-grid">
  <button class="tiny" onclick="log('Tiny Adventures')">Ti Â· Tiny</button>
  <button class="crossroads" onclick="log('Crossroads of Fate')">C Â· Crossroads</button>
  <button class="axe" onclick="log('Axe Ricochet')">A Â· Axe</button>
  <button class="card" onclick="log('Card Realm')">T Â· Treasure</button>
  <button class="block" onclick="log('Blocks Duel')">B Â· Blocks</button>
  <button class="jackpot" onclick="log('Jackpot')">J Â· Jackpot</button>
</div>

<pre id="status"></pre>
<div class="alert" id="alert"></div>

<div class="timeline" id="timelineTop"></div>
<div class="timeline" id="timelineBottom"></div>

<div class="history" id="history"></div>

<div class="controls">
  <button class="undo" onclick="undo()">Undo</button>
  <button class="reset" onclick="resetAll()">Reset All</button>
</div>

<script>
const sequences = {
1:["Tiny Adventures","Crossroads of Fate","Tiny Adventures","Blocks Duel","Tiny Adventures","Tiny Adventures","Crossroads of Fate","Card Realm","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Blocks Duel","Jackpot"],
2:["Tiny Adventures","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Card Realm","Tiny Adventures","Tiny Adventures","Crossroads of Fate","Jackpot","Crossroads of Fate","Tiny Adventures","Blocks Duel"],
3:["Tiny Adventures","Tiny Adventures","Crossroads of Fate","Card Realm","Tiny Adventures","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Jackpot","Tiny Adventures","Blocks Duel","Crossroads of Fate"],
4:["Tiny Adventures","Tiny Adventures","Card Realm","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Crossroads of Fate","Axe Ricochet","Jackpot"]
};

const abbrev = {
"Tiny Adventures":"Ti",
"Crossroads of Fate":"C",
"Axe Ricochet":"A",
"Card Realm":"T",
"Blocks Duel":"B",
"Jackpot":"J"
};

let history=[];
let possibilities=[];
let sequenceStarted=false;
let autoStartNextSequence=false;

function manualStart(){
  history=[];
  possibilities=[];
  sequenceStarted=true;
  render();
}

function resetAll(){
  history=[];
  possibilities=[];
  sequenceStarted=false;
  autoStartNextSequence=false;
  render();
}

function undo(){
  if(history.length === 0) return;
  history.pop();
  rebuild();
}

function rebuild(){
  const wasSequenceStarted = sequenceStarted;
  possibilities=[];
  
  if(history.length === 0){
    sequenceStarted = wasSequenceStarted;
    render();
    return;
  }
  
  // First event - check if we were in a started sequence
  if(wasSequenceStarted){
    for(const [seq,moves] of Object.entries(sequences)){
      if(moves[0]===history[0])
        possibilities.push({seq,move:1});
    }
  } else {
    for(const [seq,moves] of Object.entries(sequences)){
      moves.forEach((m,i)=>{
        if(m===history[0])
          possibilities.push({seq,move:i+1});
      });
    }
  }
  
  // Process remaining events
  for(let i=1; i<history.length; i++){
    possibilities = possibilities
      .filter(p=>sequences[p.seq][p.move]===history[i])
      .map(p=>({seq:p.seq,move:p.move+1}));
  }
  
  render();
}

function log(event){
  if(autoStartNextSequence){
    history=[];
    possibilities=[];
    sequenceStarted=true;
    autoStartNextSequence=false;
  }

  history.push(event);
  process(event);
  render();
}

function process(event){
  if(!possibilities.length){
    for(const [seq,moves] of Object.entries(sequences)){
      if(sequenceStarted){
        if(moves[0]===event)
          possibilities.push({seq,move:1});
      } else {
        moves.forEach((m,i)=>{
          if(m===event)
            possibilities.push({seq,move:i+1});
        });
      }
    }
  } else {
    possibilities = possibilities
      .filter(p=>sequences[p.seq][p.move]===event)
      .map(p=>({seq:p.seq,move:p.move+1}));
  }
}

function render(){
  const status=document.getElementById("status");
  const alert=document.getElementById("alert");
  const top=document.getElementById("timelineTop");
  const bottom=document.getElementById("timelineBottom");
  const historyBox=document.getElementById("history");

  top.innerHTML="";
  bottom.innerHTML="";
  alert.textContent="";
  historyBox.innerHTML = history.map((e,i)=>`${i+1}. ${e}`).join("<br>");

  if(!history.length){
    status.textContent="Waiting for input...";
    return;
  }

  if(possibilities.length!==1){
    status.textContent=`Moves logged: ${history.length}\nPossible positions: ${possibilities.length}`;
    return;
  }

  const p=possibilities[0];
  const moves=sequences[p.seq];

  status.textContent=`Sequence ${p.seq}\nMove ${p.move} / 13`;

  if(p.move===13){
    alert.textContent="âœ… Sequence complete â€” next tap starts a new sequence";
    autoStartNextSequence=true;
  }

  const upcoming=moves.slice(p.move);
  const warnIndex=upcoming.findIndex(m=>m==="Axe Ricochet"||m==="Card Realm");

  if(warnIndex===0){
    alert.textContent = upcoming[0]==="Axe Ricochet"
      ? "ðŸš¨ ENABLE 50Ã— NOW (Axe Ricochet)"
      : "ðŸ’° Card Realm â€” invest 50Ã— if you need gold";
  } else if(warnIndex>0){
    status.textContent+=`\nNext ${upcoming[warnIndex]} at move ${p.move+warnIndex+1}`;
  }

  moves.forEach((m,i)=>{
    const cell=document.createElement("div");
    cell.className="cell";
    if(m==="Axe Ricochet"||m==="Card Realm"){
      cell.style.background = m==="Axe Ricochet" ? "#c0392b" : "#2980b9";
      cell.style.border="2px solid white";
    }
    if(i+1<p.move) cell.classList.add("done");
    if(i+1===p.move) cell.classList.add("current");
    if(warnIndex>=0 && i+1===p.move+warnIndex) cell.classList.add("warning");

    let l=abbrev[m];
    if(l==="A"||l==="T") l=`<b>${l}</b>`;
    cell.innerHTML=`<small>${i+1}</small><br>${l}`;
    (i<6?top:bottom).appendChild(cell);
  });
}
</script>
</body>
</html>
