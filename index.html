<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Joyland Tracker</title>

<style>
  body {
    font-family: system-ui, sans-serif;
    background: #0f0f0f;
    color: #fff;
    text-align: center;
    padding: 1rem;
  }

  h2 { margin-bottom: .3rem; }

  .desc {
    font-size: 0.95rem;
    color: #ccc;
    margin-bottom: 1rem;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
  }

  button {
    font-size: 1.1rem;
    padding: 1rem;
    margin: .35rem;
    width: 90%;
    max-width: 420px;
    border-radius: 12px;
    border: none;
  }

  .tiny { background: #444; }
  .axe { background: #c0392b; }
  .card { background: #2980b9; }
  .block { background: #27ae60; }
  .jackpot { background: #f1c40f; color: #000; }
  .undo { background: #8e44ad; }
  .reset { background: #555; }

  .timeline {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 1rem;
  }

  .cell {
    width: 26px;
    height: 26px;
    margin: 3px;
    border-radius: 6px;
    background: #333;
    font-size: 0.8rem;
    line-height: 26px;
  }

  .done { background: #666; }
  .current { background: #3498db; }
  .warning { background: #e67e22; }

  .last {
    margin-top: .5rem;
    font-size: .9rem;
    color: #aaa;
  }
</style>
</head>

<body>

<h2>Joyland Tracker</h2>

<div class="desc">
  Tap each event as you encounter it in Joyland.<br>
  This tracker identifies your sequence and move so you can
  <b>use 50x compass on Axe Ricochet and Card Realm</b>.
</div>

<button class="tiny" onclick="log('Tiny Adventures')">Tiny Adventures</button>
<button class="axe" onclick="log('Axe Ricochet')">Axe Ricochet</button>
<button class="card" onclick="log('Card Realm')">Card Realm</button>
<button class="block" onclick="log('Blocks Duel')">Blocks Duel</button>
<button class="jackpot" onclick="log('Jackpot')">Jackpot</button>

<button class="undo" onclick="undo()">Undo Last Tap</button>
<button class="reset" onclick="reset()">Reset Cycle</button>

<pre id="status"></pre>
<div class="last" id="lastTap"></div>
<div class="timeline" id="timeline"></div>

<script>
const sequences = {
  1:["Tiny Adventures","Crossroads of Fate","Tiny Adventures","Blocks Duel","Tiny Adventures","Tiny Adventures","Crossroads of Fate","Card Realm","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Blocks Duel","Jackpot"],
  2:["Tiny Adventures","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Card Realm","Tiny Adventures","Tiny Adventures","Crossroads of Fate","Jackpot","Crossroads of Fate","Tiny Adventures","Blocks Duel"],
  3:["Tiny Adventures","Tiny Adventures","Crossroads of Fate","Card Realm","Tiny Adventures","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Jackpot","Tiny Adventures","Blocks Duel","Crossroads of Fate"],
  4:["Tiny Adventures","Tiny Adventures","Card Realm","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Crossroads of Fate","Axe Ricochet","Jackpot"]
};

let history = [];
let possibilities = [];

function reset() {
  history = [];
  possibilities = [];
  document.getElementById("status").textContent = "Cycle reset.";
  document.getElementById("timeline").innerHTML = "";
  document.getElementById("lastTap").textContent = "";
}

function undo() {
  if (history.length === 0) return;
  history.pop();
  rebuild();
}

function rebuild() {
  possibilities = [];
  document.getElementById("timeline").innerHTML = "";

  history.forEach(e => process(e));
  render();
}

function log(event) {
  history.push(event);
  process(event);
  render();
}

function process(event) {
  if (possibilities.length === 0) {
    for (const [seq, moves] of Object.entries(sequences)) {
      moves.forEach((m, i) => {
        if (m === event) possibilities.push({ seq, move: i + 1 });
      });
    }
  } else {
    possibilities = possibilities
      .filter(p => sequences[p.seq][p.move] === event)
      .map(p => ({ seq: p.seq, move: p.move + 1 }));
  }
}

function render() {
  const status = document.getElementById("status");
  const timeline = document.getElementById("timeline");
  const lastTap = document.getElementById("lastTap");
  timeline.innerHTML = "";

  lastTap.textContent =
    history.length > 0
      ? `Last tap: ${history[history.length - 1]} (${history.length} total)`
      : "";

  status.textContent =
    `Moves logged: ${history.length}\n` +
    `Possible positions: ${possibilities.length}`;

  if (possibilities.length !== 1) return;

  const p = possibilities[0];
  const moves = sequences[p.seq];

  status.textContent =
    `Sequence ${p.seq}\n` +
    `Move ${p.move} / 13`;

  const upcoming = moves.slice(p.move);
  const warnIndex = upcoming.findIndex(m =>
    m === "Axe Ricochet" || m === "Card Realm"
  );

  if (warnIndex === 0) {
    status.textContent += `\n⚠️ ENABLE 50x NOW`;
  } else if (warnIndex > 0) {
    status.textContent +=
      `\nNext ${upcoming[warnIndex]} at move ${p.move + warnIndex + 1}`;
  }

  moves.forEach((_, i) => {
    const cell = document.createElement("div");
    cell.className = "cell";

    if (i + 1 < p.move) cell.classList.add("done");
    if (i + 1 === p.move) cell.classList.add("current");
    if (warnIndex >= 0 && i + 1 === p.move + warnIndex)
      cell.classList.add("warning");

    cell.textContent = i + 1;
    timeline.appendChild(cell);
  });
}
</script>

</body>
</html>
