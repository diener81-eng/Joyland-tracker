<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Joyland Tracker</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background:#0f0f0f;
  color:#fff;
  text-align:center;
  padding:1rem;
}

button {
  font-size:1.05rem;
  padding:1rem;
  margin:.35rem;
  width:90%;
  max-width:420px;
  border-radius:12px;
  border:none;
}

.start { background:#2ecc71; color:#000; font-weight:bold; }
.tiny { background:#444; }
.crossroads { background:#16a085; }
.axe { background:#c0392b; }
.treasure { background:#2980b9; }
.block { background:#27ae60; }
.jackpot { background:#f1c40f; color:#000; }

.undo { background:#8e44ad; }
.reset { background:#555; }

.history {
  max-height:120px;
  overflow-y:auto;
  background:#181818;
  border-radius:10px;
  padding:.5rem;
  font-size:.9rem;
  color:#ccc;
  margin:.75rem auto;
  width:90%;
  max-width:420px;
  text-align:left;
}

.timeline { display:flex; justify-content:center; margin-top:.5rem; }
#timelineBottom { margin-top:10px; }

.cell {
  width:28px;
  height:28px;
  margin:4px;
  border-radius:6px;
  font-size:.8rem;
  line-height:28px;
  background:#333;
}

.done { filter:brightness(.6); }
.current { outline:3px solid #fff; }
.warning { outline:3px solid #e67e22; }

.alert { margin-top:.5rem; font-size:1.05rem; font-weight:bold; }
</style>
</head>

<body>

<h2>Joyland Tracker</h2>

<button class="start" onclick="manualStart()">
This is the start of a new sequence
</button>

<button class="tiny" onclick="log('Tiny Adventures')">T Â· Tiny</button>
<button class="crossroads" onclick="log('Crossroads of Fate')">F Â· Crossroads</button>
<button class="axe" onclick="log('Axe Ricochet')">A Â· Axe</button>
<button class="treasure" onclick="log('Treasure Hunt')">C Â· Treasure Hunt</button>
<button class="block" onclick="log('Blocks Duel')">B Â· Blocks</button>
<button class="jackpot" onclick="log('Jackpot')">J Â· Jackpot</button>

<pre id="status"></pre>
<div class="alert" id="alert"></div>
<div class="history" id="history"></div>

<div class="timeline" id="timelineTop"></div>
<div class="timeline" id="timelineBottom"></div>

<button class="undo" onclick="undo()">Undo</button>
<button class="reset" onclick="resetAll()">Reset All</button>

<script>
const sequences = {
1:["Tiny Adventures","Crossroads of Fate","Tiny Adventures","Blocks Duel","Tiny Adventures","Tiny Adventures","Crossroads of Fate","Treasure Hunt","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Blocks Duel","Jackpot"],
2:["Tiny Adventures","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Treasure Hunt","Tiny Adventures","Tiny Adventures","Crossroads of Fate","Jackpot","Crossroads of Fate","Tiny Adventures","Blocks Duel"],
3:["Tiny Adventures","Tiny Adventures","Crossroads of Fate","Treasure Hunt","Tiny Adventures","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Jackpot","Tiny Adventures","Blocks Duel","Crossroads of Fate"],
4:["Tiny Adventures","Tiny Adventures","Treasure Hunt","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Crossroads of Fate","Axe Ricochet","Jackpot"]
};

const abbrev = {
"Tiny Adventures":"T",
"Crossroads of Fate":"F",
"Axe Ricochet":"A",
"Treasure Hunt":"C",
"Blocks Duel":"B",
"Jackpot":"J"
};

let history=[];
let possibilities=[];
let forcedStart=false;
let autoStartNextSequence=false;

function manualStart(){
  history=[];
  possibilities=[];
  forcedStart=true;
  render();
}

function resetAll(){
  history=[];
  possibilities=[];
  forcedStart=false;
  autoStartNextSequence=false;
  render();
}

function undo(){
  history.pop();
  rebuild();
}

function rebuild(){
  possibilities=[];
  history.forEach(e=>process(e));
  render();
}

function log(event){
  if(autoStartNextSequence){
    history=[];
    possibilities=[];
    forcedStart=true;
    autoStartNextSequence=false;
  }

  history.push(event);
  process(event);
  render();
}

function process(event){
  if(!possibilities.length){
    for(const [seq,moves] of Object.entries(sequences)){
      if(forcedStart){
        if(moves[0]===event)
          possibilities.push({seq,move:1});
      } else {
        moves.forEach((m,i)=>{
          if(m===event)
            possibilities.push({seq,move:i+1});
        });
      }
    }
  } else {
    possibilities = possibilities
      .filter(p=>sequences[p.seq][p.move]===event)
      .map(p=>({seq:p.seq,move:p.move+1}));
  }
}

function render(){
  const status=document.getElementById("status");
  const alert=document.getElementById("alert");
  const top=document.getElementById("timelineTop");
  const bottom=document.getElementById("timelineBottom");
  const historyBox=document.getElementById("history");

  top.innerHTML="";
  bottom.innerHTML="";
  alert.textContent="";
  historyBox.innerHTML = history.map((e,i)=>`${i+1}. ${e}`).join("<br>");

  if(!history.length){
    status.textContent="Waiting for input...";
    return;
  }

  if(possibilities.length!==1){
    status.textContent=`Moves logged: ${history.length}\nPossible positions: ${possibilities.length}`;
    return;
  }

  const p=possibilities[0];
  const moves=sequences[p.seq];

  status.textContent=`Sequence ${p.seq}\nMove ${p.move} / 13`;

  if(p.move===13){
    alert.textContent="âœ… Sequence complete â€” next tap starts a new sequence";
    autoStartNextSequence=true;
  }

  const upcoming=moves.slice(p.move);
  const warnIndex=upcoming.findIndex(m=>m==="Axe Ricochet"||m==="Treasure Hunt");

  if(warnIndex===0){
    alert.textContent = upcoming[0]==="Axe Ricochet"
      ? "ðŸš¨ ENABLE 50Ã— NOW (Axe Ricochet)"
      : "ðŸ’° Treasure Hunt â€” invest 50Ã— if you need gold";
  } else if(warnIndex>0){
    status.textContent+=`\nNext ${upcoming[warnIndex]} at move ${p.move+warnIndex+1}`;
  }

  moves.forEach((m,i)=>{
    const cell=document.createElement("div");
    cell.className="cell";
    if(m==="Axe Ricochet"||m==="Treasure Hunt"){
      cell.style.background = m==="Axe Ricochet" ? "#c0392b" : "#2980b9";
      cell.style.border="2px solid white";
    }
    if(i+1<p.move) cell.classList.add("done");
    if(i+1===p.move) cell.classList.add("current");
    if(warnIndex>=0 && i+1===p.move+warnIndex) cell.classList.add("warning");

    let l=abbrev[m];
    if(l==="A"||l==="C") l=`<b>${l}</b>`;
    cell.innerHTML=`<small>${i+1}</small><br>${l}`;
    (i<6?top:bottom).appendChild(cell);
  });

  forcedStart=false;
}
</script>
</body>
</html>
