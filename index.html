<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Joyland Tracker</title>

<style>
  body {
    font-family: system-ui, sans-serif;
    background: #0f0f0f;
    color: #fff;
    text-align: center;
    padding: 1rem;
  }

  h2 { margin-bottom: .3rem; }

  .desc {
    font-size: 0.95rem;
    color: #ccc;
    margin-bottom: 1rem;
    max-width: 520px;
    margin-left: auto;
    margin-right: auto;
  }

  button {
    font-size: 1.05rem;
    padding: 1rem;
    margin: .35rem;
    width: 90%;
    max-width: 420px;
    border-radius: 12px;
    border: none;
  }

  .tiny { background: #444; }
  .axe { background: #c0392b; }
  .treasure { background: #2980b9; }
  .block { background: #27ae60; }
  .jackpot { background: #f1c40f; color: #000; }
  .crossroads { background: #16a085; }

  .undo { background: #8e44ad; }
  .reset { background: #555; }

  .divider {
    margin: 1.2rem auto;
    width: 90%;
    max-width: 420px;
    border-top: 1px solid #333;
  }

  .history {
    max-height: 120px;
    overflow-y: auto;
    background: #181818;
    border-radius: 10px;
    padding: .5rem;
    font-size: .9rem;
    color: #ccc;
    margin: .75rem auto;
    width: 90%;
    max-width: 420px;
    text-align: left;
  }

  .timeline {
    display: flex;
    justify-content: center;
    margin-top: 1rem;
  }

  .cell {
    width: 26px;
    height: 26px;
    margin: 3px;
    border-radius: 6px;
    background: #333;
    font-size: 0.8rem;
    line-height: 26px;
    text-align: center;
  }

  .done { background: #666; }
  .current { background: #3498db; }
  .warning { background: #e67e22; }

  .alert {
    margin-top: .5rem;
    font-size: 1.1rem;
    font-weight: bold;
    color: #ff9f43;
  }

  #timelineBottom { margin-top: 8px; }

  .toggle {
    margin: .5rem auto;
    font-size: .95rem;
    color: #ccc;
  }
</style>
</head>

<body>

<h2>Joyland Tracker</h2>

<div class="desc">
  Tap each event as it appears in Joyland.<br>
  Uses sequence logic to warn when to use <b>50Ã— compass</b>.<br>
  Axe Ricochet â†’ always 50Ã—<br>
  Treasure Hunt â†’ 50Ã— only if you need gold
</div>

<div class="toggle">
  <label>
    <input type="checkbox" id="needGold">
    I need gold (enable 50Ã— on Treasure Hunt)
  </label>
</div>

<!-- INPUT BUTTONS -->
<button class="tiny" onclick="log('Tiny Adventures')">T Â· Tiny Adventures</button>
<button class="crossroads" onclick="log('Crossroads of Fate')">F Â· Crossroads of Fate</button>
<button class="axe" onclick="log('Axe Ricochet')">A Â· Axe Ricochet</button>
<button class="treasure" onclick="log('Treasure Hunt')">C Â· Treasure Hunt (Card Realm)</button>
<button class="block" onclick="log('Blocks Duel')">B Â· Blocks Duel</button>
<button class="jackpot" onclick="log('Jackpot')">J Â· Jackpot</button>

<pre id="status"></pre>
<div class="alert" id="alert"></div>

<div class="history" id="history"></div>

<div class="timeline" id="timelineTop"></div>
<div class="timeline" id="timelineBottom"></div>

<div class="divider"></div>
<button class="undo" onclick="undo()">Undo Last Tap</button>
<button class="reset" onclick="startBrandNewCycle()">Start Brand New Cycle</button>

<script>
const sequences = {
  1:["Tiny Adventures","Crossroads of Fate","Tiny Adventures","Blocks Duel","Tiny Adventures","Tiny Adventures","Crossroads of Fate","Treasure Hunt","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Blocks Duel","Jackpot"],
  2:["Tiny Adventures","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Treasure Hunt","Tiny Adventures","Tiny Adventures","Crossroads of Fate","Jackpot","Crossroads of Fate","Tiny Adventures","Blocks Duel"],
  3:["Tiny Adventures","Tiny Adventures","Crossroads of Fate","Treasure Hunt","Tiny Adventures","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Jackpot","Tiny Adventures","Blocks Duel","Crossroads of Fate"],
  4:["Tiny Adventures","Tiny Adventures","Treasure Hunt","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Axe Ricochet","Tiny Adventures","Crossroads of Fate","Tiny Adventures","Crossroads of Fate","Axe Ricochet","Jackpot"]
};

const abbrev = {
  "Tiny Adventures":"T",
  "Axe Ricochet":"A",
  "Treasure Hunt":"C",
  "Blocks Duel":"B",
  "Jackpot":"J",
  "Crossroads of Fate":"F"
};

let history = [];
let possibilities = [];
let completedSequences = [];
let cycleKnownStart = false;
let awaitingNewSequence = false;

/* ---------- persistence ---------- */
(function loadState(){
  const s = localStorage.getItem("joylandState");
  if(!s) return;
  const d = JSON.parse(s);
  history = d.history || [];
  possibilities = d.possibilities || [];
  completedSequences = d.completedSequences || [];
  cycleKnownStart = d.cycleKnownStart || false;
  awaitingNewSequence = d.awaitingNewSequence || false;
})();
function saveState(){
  localStorage.setItem("joylandState", JSON.stringify({
    history, possibilities, completedSequences,
    cycleKnownStart, awaitingNewSequence
  }));
}

/* ---------- controls ---------- */
function startBrandNewCycle(){
  history=[];
  possibilities=[];
  completedSequences=[];
  cycleKnownStart=true;
  awaitingNewSequence=false;
  render();
}

function undo(){
  if(!history.length) return;
  history.pop();
  rebuild();
}

function rebuild(){
  possibilities=[];
  history.forEach(e=>process(e));
  render();
}

function log(event){
  if(awaitingNewSequence && possibilities.length===1){
    const s = possibilities[0].seq;
    if(!completedSequences.includes(s)) completedSequences.push(s);
    history=[];
    possibilities=[];
    awaitingNewSequence=false;
  }
  history.push(event);
  process(event);
  render();
}

/* ---------- logic ---------- */
function process(event){
  if(!possibilities.length){
    for(const [seq,moves] of Object.entries(sequences)){
      moves.forEach((m,i)=>{
        if(m===event) possibilities.push({seq,move:i+1});
      });
    }
  } else {
    possibilities = possibilities
      .filter(p=>sequences[p.seq][p.move]===event)
      .map(p=>({seq:p.seq,move:p.move+1}));
  }
}

/* ---------- render ---------- */
function render(){
  const status=document.getElementById("status");
  const alert=document.getElementById("alert");
  const historyBox=document.getElementById("history");
  const top=document.getElementById("timelineTop");
  const bottom=document.getElementById("timelineBottom");
  const needGold=document.getElementById("needGold").checked;

  top.innerHTML="";
  bottom.innerHTML="";
  alert.textContent="";

  historyBox.innerHTML=history.map((e,i)=>`${i+1}. ${e}`).join("<br>");

  status.textContent=
    `Moves logged: ${history.length}\n`+
    `Possible positions: ${possibilities.length}`;

  if(possibilities.length!==1){
    saveState();
    return;
  }

  const p=possibilities[0];
  const moves=sequences[p.seq];

  status.textContent=
    `Sequence ${p.seq}\nMove ${p.move} / 13`;

  if(p.move===1)
    status.textContent+="\n(Start of a new sequence)";

  if(cycleKnownStart && completedSequences.length===0)
    status.textContent+="\nCycle status: Brand new";
  else if(completedSequences.length===0)
    status.textContent+="\nCycle status: Unknown start";
  else
    status.textContent+=`\nCompleted this cycle: ${completedSequences.join(", ")}`;

  const remaining=["1","2","3","4"].filter(
    s=>!completedSequences.includes(s)&&s!==p.seq
  );
  if(cycleKnownStart||completedSequences.length)
    status.textContent+=`\nPossible upcoming sequences: ${remaining.join(", ")}`;

  const upcoming=moves.slice(p.move);
  const warnIndex=upcoming.findIndex(
    m=>m==="Axe Ricochet"||(m==="Treasure Hunt"&&needGold)
  );

  if(warnIndex===0){
    alert.textContent="ðŸš¨ ENABLE 50x NOW ðŸš¨";
  } else if(warnIndex>0){
    status.textContent+=
      `\nNext ${upcoming[warnIndex]} at move ${p.move+warnIndex+1}`;
  }

  moves.forEach((m,i)=>{
    const cell=document.createElement("div");
    cell.className="cell";
    if(i+1<p.move) cell.classList.add("done");
    if(i+1===p.move) cell.classList.add("current");
    if(warnIndex>=0 && i+1===p.move+warnIndex)
      cell.classList.add("warning");

    let l=abbrev[m];
    if(l==="A"||l==="C") l=`<b>${l}</b>`;
    cell.innerHTML=`<small>${i+1}</small><br>${l}`;

    if(m==="Axe Ricochet"||m==="Treasure Hunt")
      cell.style.border="2px solid white";

    (i<6?top:bottom).appendChild(cell);
  });

  if(p.move===13){
    alert.textContent="âœ… Sequence complete. Next tap starts a new sequence.";
    awaitingNewSequence=true;
  }

  saveState();
}

render();
</script>

</body>
</html>
